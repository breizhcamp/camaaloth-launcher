<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <script src="/webjars/axios/0.18.0/dist/axios.min.js"></script>
    <script src="/webjars/moment/2.24.0/min/moment-with-locales.min.js"></script>
    <script src="/webjars/vue-moment/4.0.0/dist/vue-moment.min.js"></script>
    <script src="/webjars/moment-duration-format/2.2.2/lib/moment-duration-format.js"></script>
    <script src="/webjars/vue/2.5.17/dist/vue.js" ></script>
    <script src="/static/js/lib.js" th:src="@{/js/lib.js}"></script>

    <style>
        .stdlog { max-height: 500px }
    </style>
</head>

<body>
<div layout:fragment="content">
    <div th:replace="stepper :: stepper(step = 5)"></div>

    <div id="vue">

        <div class="row mb-3" v-if="log.length > 0">
            <div class="col-sm-12">
				<pre class="pre-scrollable stdlog" ref="logPre">
{{log.join('\n')}}
				</pre>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#vue',
            data: {
                log: []
            },

            created() {
                this.connectToWS()
            },

            methods: {
                connectToWS() {
                    ws.sub('/050-copy-out', msg => {
                        let body = msg.body
                        if (body === '---- NEW STREAM ----') {
                            this.log = []
                        }

                        this.log.push(body)

                        //limit number of lines
                        if (this.log.length > 100) {
                            this.log.splice(0, this.log.length - 100)
                        }

                        //scroll log at bottom
                        let log = this.$refs.logPre;
                        if (log) log.scrollTop = log.scrollHeight;
                    })
                }
            }
        })
    </script>
</div>
</body>
</html>